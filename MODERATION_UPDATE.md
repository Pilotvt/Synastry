# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äî Quality + Lonely Face

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (NEW!)
**–ü—Ä–æ–±–ª–µ–º–∞:** NudeNet 640m –º–æ–¥–µ–ª—å (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 640x640px) —Ç–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö ‚Äî –Ω–µ –≤–∏–¥–∏—Ç –¥–µ—Ç–∞–ª–∏ —Ç–µ–ª–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –∂—ë—Å—Ç–∫–∏–π –ø–æ—Ä–æ–≥ **300px** ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—å—à–µ —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ "–Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ".

**–õ–æ–≥–∏–∫–∞:**
```python
MIN_IMAGE_EDGE_FOR_DATING = 300  # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```
- –ï—Å–ª–∏ `width < 300` –ò–õ–ò `height < 300` ‚Üí –±–ª–æ–∫–∏—Ä—É–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- Reason: `"Image resolution too low (WxH px), minimum 300px required"`
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: NudeNet —Ä–µ—Å–∞–π–∑–∏—Ç –º–∞–ª–µ–Ω—å–∫–∏–µ —Ñ–æ—Ç–æ ‚Üí —Ç–µ—Ä—è—é—Ç—Å—è –¥–µ—Ç–∞–ª–∏ ‚Üí –¥–µ—Ç–µ–∫—Ç–æ—Ä –Ω–µ –≤–∏–¥–∏—Ç —Ç–µ–ª–æ

### 2. –≠–≤—Ä–∏—Å—Ç–∏–∫–∞ "–æ–¥–∏–Ω–æ–∫–æ–µ –ª–∏—Ü–æ" (lonely_face)
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ç–æ –º—É–∂—á–∏–Ω—ã –≤ –±–µ–ª—å–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª–æ—Å—å (—Ç–æ–ª—å–∫–æ `FACE_MALE` –¥–µ—Ç–µ–∫—Ü–∏—è, NudeNet –Ω–µ –≤–∏–¥–µ–ª —Ç–µ–ª–æ).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ ‚Äî –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ **—Ç–æ–ª—å–∫–æ –ª–∏—Ü–æ** –±–µ–∑ –¥—Ä—É–≥–∏—Ö –¥–µ—Ç–µ–∫—Ü–∏–π, –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ –¥–≤—É–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:
- **–ú–∞–ª–µ–Ω—å–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** (<600px –ª—é–±–∞—è —Å—Ç–æ—Ä–æ–Ω–∞) ‚Üí –≤—Å–µ–≥–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
- **–ë–æ–ª—å—à–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** (‚â•600px) + –≤—ã—Å–æ–∫–∏–π skin_ratio (‚â•0.25) ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å

**–õ–æ–≥–∏–∫–∞:**
```python
LONELY_FACE_SMALL_IMAGE_EDGE = 600  # –º–∞–ª–µ–Ω—å–∫–∏–µ —Ñ–æ—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã
LONELY_FACE_MIN_SKIN_RATIO = 0.25   # –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–æ—Ç–æ —Ç—Ä–µ–±—É–µ–º –≤—ã—Å–æ–∫–∏–π skin_ratio
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `app/moderation/image.py`

**–ù–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
```python
LONELY_FACE_BLOCK = True  # –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
LONELY_FACE_MIN_CONFIDENCE = 0.60  # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ª–∏—Ü–∞
```

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ `len(detections) == 1` –ò —ç—Ç–æ –ª–∏—Ü–æ —Å `confidence >= 0.60`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `unsafe_score = 0.50` –∏ –±–ª–æ–∫–∏—Ä—É–µ–º
- –î–æ–±–∞–≤–ª—è–µ–º –≤ reason: `lonely_face_only`

### 3. –û–±–Ω–æ–≤–ª—ë–Ω `requirements.txt`
```diff
+ Pillow>=10.0.0
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
```powershell
& "C:\Users\user\Git\Synastry\python-env\Scripts\python.exe" -m pip install -r requirements.txt
```
Pillow 12.0.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚úÖ

## üß™ –¢–µ—Å—Ç

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```
[NUDENET] Detections: [{'class': 'FACE_MALE', 'score': 0.695}]
[NUDENET] Skin ratio = 0.140 (threshold=0.3)
is_clean=True ‚ùå –ü–†–û–ü–£–©–ï–ù–û
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```
[NUDENET] Detections: [{'class': 'FACE_MALE', 'score': 0.695}]
[NUDENET] LONELY FACE triggered: only face detected (conf=0.695)
is_clean=False ‚úÖ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û
reason: "NudeNet blocked: unsafe=0.50, lonely_face_only"
```

## üì¶ –í–∫–ª—é—á–µ–Ω–æ –≤ —Å–±–æ—Ä–∫—É

- `requirements.txt` ‚Üí –≤–∫–ª—é—á–∞–µ—Ç Pillow
- `scripts/build_backend_env.py` ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `package.json` ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç `python-env` –≤ production

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è production build!**

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –û—Ç–∫–ª—é—á–∏—Ç—å lonely_face (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Å–µ–ª—Ñ–∏):
```python
# app/moderation/image.py
LONELY_FACE_BLOCK = False
```

### –°–¥–µ–ª–∞—Ç—å —Å—Ç—Ä–æ–∂–µ:
```python
LONELY_FACE_MIN_CONFIDENCE = 0.50  # –±—ã–ª–æ 0.60
```

### –°–¥–µ–ª–∞—Ç—å –º—è–≥—á–µ:
```python
LONELY_FACE_MIN_CONFIDENCE = 0.70  # –±—ã–ª–æ 0.60
```

## üéØ –ö–æ–≥–¥–∞ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

- –§–æ—Ç–æ —Å –ª–∏—Ü–æ–º + –æ–¥–µ–∂–¥–∞ (NudeNet –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç `TORSO`, `CLOTHING`)
- –§–æ—Ç–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–∏—Ü–∞–º–∏ (–≥—Ä—É–ø–ø–æ–≤–æ–µ)
- –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ª–∏—Ü–∞ (< 0.60)
- –õ—é–±—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∫—Ä–æ–º–µ –ª–∏—Ü–∞ (–¥–∞–∂–µ `ARMPITS`, `BELLY`)

## üéØ –ö–æ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

- **–¢–æ–ª—å–∫–æ** `FACE_MALE` –∏–ª–∏ `FACE_FEMALE` —Å conf >= 0.60
- –¢–∏–ø–∏—á–Ω–æ –¥–ª—è: beach photos, underwear, inappropriate poses
- –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è dating-–ø—Ä–æ—Ñ–∏–ª–µ–π

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production
**–¢–µ—Å—Ç:** ‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç (`male_underwear.jpg` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å–±–æ—Ä–∫—É
